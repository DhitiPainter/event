<mat-toolbar color="primary">
  <span class="fill-remaining-space">Event Management Form</span>
  <button mat-raised-button color="secondary" (click)="goToList()">List</button>
</mat-toolbar>

<div class="container" *ngIf="!post; else forminfo" novalidate>
  <form [formGroup]="formGroup" (ngSubmit)="onSubmit()" class="form">
    <!-- title -->
    <mat-form-field class="form-element">
      <input matInput placeholder="Title" formControlName="title" />
      <mat-error
        *ngIf="
          !formGroup.controls['title'].valid &&
          formGroup.controls['title'].touched
        "
      >
        Enter valid title
      </mat-error>
    </mat-form-field>
    <!-- all day check -->
    <div class="form-element">
      <mat-checkbox formControlName="isAllDay" value="1">ALL Day</mat-checkbox>
    </div>
    <!-- start date -->
    <div
      *ngIf="formGroup.controls['isAllDay'].value; else startDatetime"
      class="form-element"
    >
      <mat-form-field>
        <input
          matInput
          [ngxMatDatetimePicker]="startDate"
          placeholder="Start date"
          formControlName="startDate"
        />
        <mat-datepicker-toggle
          matSuffix
          [for]="startDate"
        ></mat-datepicker-toggle>
        <mat-datepicker #startDate></mat-datepicker>
      </mat-form-field>
    </div>
    <ng-template #startDatetime>
      <mat-form-field class="form-element">
        <input
          matInput
          [ngxMatDatetimePicker]="startDate"
          placeholder="Start date"
          formControlName="startDate"
        />
        <mat-datepicker-toggle
          matSuffix
          [for]="startDate"
        ></mat-datepicker-toggle>
        <ngx-mat-datetime-picker #startDate></ngx-mat-datetime-picker>
      </mat-form-field>
    </ng-template>
    <!-- end date -->
    <div
      *ngIf="formGroup.controls['isAllDay'].value; else endDatetime"
      class="form-element"
    >
      <mat-form-field>
        <input
          matInput
          [ngxMatDatetimePicker]="endDate"
          placeholder="End date"
          formControlName="endDate"
        />
        <mat-datepicker-toggle
          matSuffix
          [for]="endDate"
        ></mat-datepicker-toggle>
        <mat-datepicker #endDate></mat-datepicker>
      </mat-form-field>
    </div>
    <ng-template #endDatetime>
      <mat-form-field class="form-element">
        <input
          matInput
          [ngxMatDatetimePicker]="endDate"
          placeholder="End date"
          formControlName="endDate"
        />
        <mat-datepicker-toggle
          matSuffix
          [for]="endDate"
        ></mat-datepicker-toggle>
        <ngx-mat-datetime-picker #endDate></ngx-mat-datetime-picker>
      </mat-form-field>
    </ng-template>

    <!-- Event Details -->
    <div><b>Event Details</b></div>
    <!-- location -->
    <mat-form-field class="form-element">
      <input
        #search
        (keyup)="(0)"
        matInput
        placeholder="Location"
        aria-label="Location"
        [matAutocomplete]="auto"
        formControlName="location"
      />
      <mat-autocomplete #auto="matAutocomplete">
        <mat-option
          (onSelectionChange)="search.value != undefined"
          *ngFor="let location of filteredLocations | async"
          [value]="location.name"
        >
          <span>{{ location.name }}</span> |
        </mat-option>
      </mat-autocomplete>
    </mat-form-field>
    <!-- email -->
    <mat-form-field class="form-element">
      <input matInput placeholder="Email address" formControlName="email" />
      <mat-error
        *ngIf="
          !formGroup.controls['email'].valid &&
          formGroup.controls['email'].touched
        "
      >
        {{ getErrorEmail(i) }}
      </mat-error>
    </mat-form-field>
    <!-- description -->
    <mat-form-field class="form-element">
      <textarea
        matInput
        placeholder="Description"
        matTextareaAutosize
        matAutosizeMinRows="1"
        matAutosizeMaxRows="5"
        formControlName="desc"
      ></textarea>
      <mat-error
        *ngIf="
          !formGroup.controls['desc'].valid &&
          formGroup.controls['desc'].touched
        "
      >
        Must be up to 100 characters.
      </mat-error>
    </mat-form-field>
    <button
      mat-raised-button
      color="primary"
      type="button"
      class="button guest"
      *ngIf="formGroup.controls.email.value"
    >
      <span (click)="addGuest(); $event.preventDefault()"
        ><mat-icon>add</mat-icon>Guests</span
      >
    </button>
    <!-- guests -->
    <div *ngFor="let guest of getGuestsFormControls(); let i = index">
      <mat-form-field class="form-element guest">
        <input
          matInput
          type="text"
          placeholder="Guest name"
          [formControl]="guest"
        />
      </mat-form-field>
      <button mat-raised-button (click)="removeGuest(i)">
        <mat-icon>delete</mat-icon>
      </button>
    </div>

    <br />
    <button
      mat-raised-button
      color="primary"
      type="submit"
      class="button"
      [disabled]="!formGroup.valid"
    >
      Submit Form
    </button>
  </form>
</div>
